dist: bionic
language: c
os:
  - linux
compiler:
  - gcc
install:
  - sudo apt-get install cmake
  - sudo apt-get install libgtest-dev
  - cd /usr/src/gtest
  - sudo cmake CMakeLists.txt
  - sudo make
  - sudo cp *.a /usr/lib
  - cd -
script:
  - cmake CMakeLists.txt
  - make
matrix:

  include:
  - env:
      - TEST="CppCheck"
    script:
      - sudo apt-get install cppcheck
      - cppcheck .
  
  #
  # Clang Tidy
  #
  - env:
      - TEST="Clang Tidy"
    addons:
      apt:
        sources:
          - llvm-toolchain-xenial-7
        packages:
          - clang-7
          - clang-tidy-7
    script:
      - clang-tidy main.c -checks=-*,clang-analyzer-*,-clang-analyzer-cplusplus*
      - clang-tidy skyscrapers.c -checks=-*,clang-analyzer-*,-clang-analyzer-cplusplus*
      - clang-tidy skyscrapers.h -checks=-*,clang-analyzer-*,-clang-analyzer-cplusplus*
    
  - env:
      - TEST="Clang-format"
    script:
      - clang-format -style=Google main.c
      - clang-format -style=Google skyscrapers.c
      - clang-format -style=Google skyscrapers.h
  
  - env:
      - TEST="Cpplint"
    script:
      - pip install cpplint
      - cpplint --filter=-legal/copyright,-build/include_subdir,-readability/casting,-whitespace/line_length main.c
      - cpplint --filter=-legal/copyright,-build/include_subdir,-readability/casting,-whitespace/line_length skyscrapers.c
      - cpplint --filter=-legal/copyright skyscrapers.h
      
  - env:
      - TEST="scan-build"
    script:
      - scan-build gcc main.c skyscrapers.c skyscrapers.h
      
  - env:
      - TEST="fbinfer"
    script:
      - VERSION=1.1.0; curl -sSL "https://github.com/facebook/infer/releases/download/v$VERSION/infer-linux64-v$VERSION.tar.xz" | sudo tar -C /opt -xJ && sudo ln -s "/opt/infer-linux64-v$VERSION/bin/infer" /usr/local/bin/infer
      - infer run -- gcc -c main.c
      - infer run -- gcc -c skyscrapers.c
      - infer run -- gcc -c skyscrapers.h
after_success:
  - bash <(curl -s https://codecov.io/bash)
